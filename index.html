<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–î–µ–ª–æ –æ –°—á–∞—Å—Ç—å–µ ‚Äî –°–ø–æ—Ä –ê–ª—É–∞ vs –ù—É—Ä–∞–ª–∏ (v2.3)</title>
<meta name="description" content="–ò–≥—Ä–æ–≤–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ: —Å–ø–æ—Ä –ê–ª—É–∞ vs –ù—É—Ä–∞–ª–∏ –ø–æ–¥ –ø—Ä–∏—Å–º–æ—Ç—Ä–æ–º –°—É–¥—å–∏. –ü–æ–±–µ–¥–∞ ‚Äî –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ø–æ–¥–∞—Ä–æ–∫ ‚ù§Ô∏è" />
<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@600&family=Inter:wght@400;600&display=swap" rel="stylesheet" />
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='64' width='64'%3E%3Ctext y='48' x='6' font-size='48'%3Eüéâ%3C/text%3E%3C/svg%3E" />
<style>
  :root{
    --ink:#182435; --muted:#5c6a79; --line:#e4e9ef; --bg:#f7f9fb;
    --brand:#0b6cff; --ok:#2ea44f; --warn:#ffaf38; --bad:#e45757;
    --card:#ffffff;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(#fdfcf9,var(--bg));color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:980px;margin:28px auto 60px;padding:0 16px}
  header.card{text-align:center}
  h1{font-family:Merriweather,serif;margin:0 0 6px}
  .lead{color:var(--muted);margin:0 0 12px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;box-shadow:0 10px 26px rgba(18,38,63,.06);padding:18px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .btn{appearance:none;border:0;background:var(--brand);color:#fff;padding:12px 18px;border-radius:10px;font-weight:600;cursor:pointer;transition:.18s;box-shadow:0 6px 18px rgba(11,108,255,.18)}
  .btn:hover{transform:translateY(-1px)}
  .btn.ghost{background:#fff;color:var(--brand);border:1.5px solid var(--brand);box-shadow:none}
  .btn.warn{background:var(--warn);color:#1b1405}
  .btn.success{background:var(--ok)}
  .hint{color:var(--muted);font-size:.95rem}
  .divider{height:1px;background:var(--line);margin:14px 0}
  .scene{display:none}
  .scene.active{display:block;animation:fade .3s ease}
  @keyframes fade{from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)}}
  .progress{height:12px;background:#eef2f7;border:1px solid var(--line);border-radius:999px;overflow:hidden}
  .bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand),#43a1ff);transition:width .45s ease}
  .toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#0f172a;color:#fff;padding:10px 14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.25);font-size:.95rem;z-index:999;opacity:0}
  .type{white-space:pre-wrap;line-height:1.6;margin-top:12px}

  /* –±–ª–æ–∫ —Ä–∞—É–Ω–¥–∞ */
  .round-top{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:10px}
  .round-indicator{font-weight:700;color:#0b3b6c}
  .arena{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:840px){ .arena{grid-template-columns:1fr 1fr} }
  .avatar{
    display:flex; align-items:center; gap:12px;
    background:#fff; border:1px solid var(--line); border-radius:12px; padding:12px;
  }
  .avatar img{
    width:72px; height:72px; object-fit:cover; border-radius:12px; border:1px solid var(--line);
    background:#f2f4f7;
  }
  .bubble{padding:10px 12px;border-left:3px solid #dde4ec;border-radius:8px;background:#fff}
  .choices{display:grid;grid-template-columns:1fr;gap:10px}
  @media(min-width:720px){ .choices{grid-template-columns:repeat(3,1fr)} }
  .choice{border:1.5px solid var(--line);border-radius:12px;padding:12px;background:#fff;cursor:pointer;transition:.15s;text-align:left}
  .choice:hover{transform:translateY(-1px)}
  .choice.good{border-color:var(--ok);background:#f1fbf4}
  .choice.bad{border-color:#ffd6d6;background:#fff7f7}

  /* —Å–µ—Ä–¥–µ—á–∫–∏ */
  .heart{position:fixed;bottom:-40px;font-size:22px;animation:float 6s linear forwards;pointer-events:none}
  @keyframes float{from{transform:translateY(0)} to{transform:translateY(-120vh)}}

  /* –ø–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ –∑–≤—É–∫–∞ (–µ—Å–ª–∏ –∞–≤—Ç–æ–ø–ª–µ–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω) */
  .sound-fab{
    position:fixed; right:16px; bottom:16px; z-index:888;
    background:#0f172a; color:#fff; border:0; border-radius:999px; padding:10px 14px; cursor:pointer;
    box-shadow:0 10px 24px rgba(0,0,0,.25); display:none;
  }
</style>
</head>
<body>
<div class="wrap">
  <header class="card">
    <h1>–î–µ–ª–æ –æ —Å—á–∞—Å—Ç—å–µ</h1>
    <p class="lead">–°–ø–æ—Ä <b>–ê–ª—É–∞</b> vs <b>–ù—É—Ä–∞–ª–∏</b> –ø–æ–¥ –Ω–∞–¥–∑–æ—Ä–æ–º –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–≥–æ –°—É–¥—å–∏</p>
    <div class="progress" aria-label="–ü—Ä–æ–≥—Ä–µ—Å—Å –¥–µ–ª–∞">
      <div id="bar" class="bar"></div>
    </div>
    <div style="height:12px"></div>
    <div class="row" style="justify-content:center">
      <button id="startBtn" class="btn">–ù–∞—á–∞—Ç—å —Å–ø–æ—Ä</button>
      <button id="bribeBtn" class="btn warn" title="–ö–æ—Ñ–µ –°—É–¥—å–µ –∏ –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç üòâ" style="display:none">–ü–æ–¥–∫—É–ø–∏—Ç—å —Å—É–¥—å—é ‚òï</button>
    </div>
  </header>

  <!-- –°–¶–ï–ù–ê 1 -->
  <section id="s1" class="scene active">
    <div class="card">
      <div class="bubble"><b>–°—É–¥—å—è:</b> –û–±—ä—è–≤–ª—è—é —Å–ª—É—à–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã–º. –ê–ª—É–∞, –≤–∞–º –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç –≤—ã–±–∏—Ä–∞—Ç—å –ª—É—á—à–∏–µ –∫–æ–Ω—Ç—Ä–∞—Ä–≥—É–º–µ–Ω—Ç—ã. –£–¥–∞—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —É—Å–∫–æ—Ä—è—é—Ç –ø–æ–±–µ–¥—É.</div>
      <div class="divider"></div>
      <div class="hint">–ù–∞–∂–º–∏—Ç–µ ¬´–ù–∞—á–∞—Ç—å —Å–ø–æ—Ä¬ª, –º—É–∑—ã–∫–∞ –≤–∫–ª—é—á–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–µ—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä —Ä–∞–∑—Ä–µ—à–∏—Ç). –ï—Å–ª–∏ –∑–≤—É–∫–∞ –Ω–µ—Ç ‚Äî –ø–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ ¬´–í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫¬ª –≤–Ω–∏–∑—É.</div>
    </div>
  </section>

  <!-- –°–¶–ï–ù–ê 2 ‚Äî —Ä–∞—É–Ω–¥—ã -->
  <section id="s2" class="scene">
    <div class="card">
      <div class="round-top">
        <div id="roundIndicator" class="round-indicator">–†–∞—É–Ω–¥ 1 –∏–∑ 4</div>
        <div class="hint" id="miniHint">–í—ã–±–µ—Ä–∏—Ç–µ –ª—É—á—à–∏–π –∫–æ–Ω—Ç—Ä–∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –°—É–¥—å—è –æ—Ü–µ–Ω–∏—Ç.</div>
      </div>

      <div class="arena" id="arena">
        <!-- –ª–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ù—É—Ä–∞–ª–∏ (–¥–æ–≤–æ–¥) -->
        <div class="avatar" id="nuralyBox">
          <img id="nuralyImg" alt="–ù—É—Ä–∞–ª–∏" />
          <div class="bubble" id="nuralyLine"></div>
        </div>

        <!-- –ø—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ê–ª—É–∞ (–æ—Ç–≤–µ—Ç) -->
        <div class="avatar" id="aluaBox">
          <img id="aluaImg" alt="–ê–ª—É–∞" />
          <div class="bubble">
            <div class="hint">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç:</div>
            <div class="choices" id="choices"></div>
          </div>
        </div>
      </div>

      <div class="divider"></div>
      <div class="row" style="justify-content:space-between">
        <button id="prevBtn" class="btn ghost" disabled>‚Üê –ù–∞–∑–∞–¥</button>
        <button id="nextBtn" class="btn" disabled>–î–∞–ª–µ–µ ‚Üí</button>
      </div>
    </div>
  </section>

  <!-- –°–¶–ï–ù–ê 3 ‚Äî —Ñ–∏–Ω–∞–ª -->
  <section id="s3" class="scene">
    <div class="card">
      <div class="bubble"><b>–°—É–¥—å—è:</b> –®–∫–∞–ª–∞ –¥–æ—Å—Ç–∏–≥–ª–∞ 100%. –î–µ–ª–æ —Ä–µ—à–µ–Ω–æ: <b>–ü–æ–±–µ–¥–∞ –ê–ª—É–∞</b> üéâ</div>
      <div class="bubble"><b>–ù—É—Ä–∞–ª–∏:</b> –°–¥–∞—é—Å—å‚Ä¶ –∏ —Å —Ä–∞–¥–æ—Å—Ç—å—é –æ–≥–ª–∞—à–∞—é –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ.</div>
      <div class="divider"></div>
      <div class="row" style="justify-content:flex-start">
        <button id="giftBtn" class="btn success">üéÅ –ü–æ–ª—É—á–∏—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
        <button id="replayBtn" class="btn ghost">‚Ü∫ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
      </div>
      <div id="giftText" class="type"></div>
    </div>
  </section>
</div>

<!-- libs -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<!-- —Ñ–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ -->
<audio id="bgm" src="" preload="auto" loop playsinline></audio>
<button id="soundFab" class="sound-fab">üîä –í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫</button>

<script>
  /*****  –ù–ê–°–¢–†–û–ô–ö–ò  *****/
  // –í–°–¢–ê–í–¨ —Å—é–¥–∞ —Å—Å—ã–ª–∫—É –Ω–∞ –¥–∂–∞–∑–æ–≤—ã–π —Å–∞–∫—Å-–ª–æ—É–ø (royalty-free mp3)
  // –ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—à—å –ø—É—Å—Ç—ã–º ‚Äî –ø–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫", –∫–æ—Ç–æ—Ä–∞—è –≤–∫–ª—é—á–∏—Ç –±–µ–∑ src (–Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–∏–≥—Ä–∞–µ—Ç).
  const AUDIO_SRC = ""; // –ø—Ä–∏–º–µ—Ä: "https://cdn.pixabay.com/download/audio/2021/09/01/audio_foobar.mp3?filename=jazz-sax-loop.mp3"

  // –ê–≤–∞—Ç–∞—Ä–∫–∏ (Google Drive -> direct view)
  const IMG = {
    nuraly: {
      calm: "https://drive.google.com/uc?export=view&id=1vJJHBM4EslrBSaHF0yPM2bcqYroOEGWz",
      confident: "https://drive.google.com/uc?export=view&id=1sncAh6T6SgOiq_0wAGkKuqIzBQTUJzjB",
      surprised: "https://drive.google.com/uc?export=view&id=1BhEXGEA86BJf51z55Eo0W1Q1OYQIHKvv",
      happy: "https://drive.google.com/uc?export=view&id=1l7a5hJ608lRkk8AGv_fOCN4pKM950AoQ"
    },
    alua: {
      focus: "https://drive.google.com/uc?export=view&id=1Pxon5HEsWp4RQkRypyor9hmYr-YtKKBX",
      smile: "https://drive.google.com/uc?export=view&id=1FO-Ej3HeoAh46z-yixHlslkxu6eQc2Fl",
      laugh: "https://drive.google.com/uc?export=view&id=1GHLx1slIVQHoEAkLGUK5eDgPZrFwKoYV",
      proud: "https://drive.google.com/uc?export=view&id=1yurKfJRJqncdOFolPmHBRKqLXyGnTQI6"
    }
  };

  // –†–∞—É–Ω–¥—ã (–º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç—ã –∏ ¬´good¬ª)
  const ROUNDS = [
    {
      nuraly: "–î–æ–≤–æ–¥ ‚Ññ1: —Ü–∏—Ñ—Ä—ã –Ω–µ –≤—Ä—É—Ç. –ú–æ–∏ –º–æ–¥–µ–ª–∏ –Ω–∞ –º–æ–µ–π —Å—Ç–æ—Ä–æ–Ω–µ.",
      nFace: "confident",
      options: [
        { text: "–ú–æ—è —É–ª—ã–±–∫–∞ –ª—É—á–µ–∑–∞—Ä–Ω–∞ ‚Äî –∏ —Å–µ–≥–æ–¥–Ω—è –æ–Ω–∞ –≥–ª–∞–≤–Ω–µ–µ —Ü–∏—Ñ—Ä.", good: true, delta: 25, aFaceGood: "smile", aFaceBad: "focus" },
        { text: "–û–ø—Ä–æ–≤–µ—Ä–≥–Ω—É —Ü–∏—Ñ—Ä—ã —Ç–æ—Ä—Ç–æ–º. –ú–Ω–æ–≥–æ —Ç–æ—Ä—Ç–æ–º.", good: false, delta: 10, aFaceGood: "smile", aFaceBad: "focus" },
        { text: "–°—É–¥—å—è, –∞ –≤—ã –∑–∞–ø–∏—Å–∞–ª–∏, –∫–∞–∫–∞—è —è –º–∏–ª–∞—è?", good: false, delta: 12, aFaceGood: "laugh", aFaceBad: "focus" }
      ],
      judgeGood: "–ê—Ä–≥—É–º–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç! –£—Ä–æ–≤–µ–Ω—å –æ—á–∞—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å—Ç—ë—Ç.",
      judgeBad:  "–°–∏–º–ø–∞—Ç–∏—á–Ω–æ, –Ω–æ –Ω–µ—É–±–µ–¥–∏—Ç–µ–ª—å–Ω–æ. +—á—É—Ç—å-—á—É—Ç—å –∑–∞ –∫—Ä–µ–∞—Ç–∏–≤."
    },
    {
      nuraly: "–î–æ–≤–æ–¥ ‚Ññ2: —Ñ–∞–∫—Ç—ã —É–ø—Ä—è–º—ã ‚Äî –¥–µ–¥–ª–∞–π–Ω—ã –Ω–µ –∂–¥—É—Ç.",
      nFace: "calm",
      options: [
        { text: "–°—á–∞—Å—Ç—å–µ –≤–∞–∂–Ω–µ–µ –¥–µ–¥–ª–∞–π–Ω–æ–≤. –°–µ–≥–æ–¥–Ω—è –ø—Ä–∞–∑–¥–Ω–∏–∫ ‚Äî —Ñ–∞–∫—Ç—ã –ø–æ–¥–æ–∂–¥—É—Ç.", good: true, delta: 25, aFaceGood: "smile", aFaceBad: "focus" },
        { text: "–£–ø—Ä—è–º—Å—Ç–≤–æ —Ñ–∞–∫—Ç–æ–≤ –ª–µ—á–∏—Ç—Å—è –∫–æ—Ñ–µ-–±—Ä–µ–π–∫–æ–º.", good: false, delta: 12, aFaceGood: "smile", aFaceBad: "focus" },
        { text: "–ü—Ä–æ—à—É –ø—Ä–∏–æ–±—â–∏—Ç—å –≤–∫—É—Å–Ω—ã–π –ø–∏—Ä–æ–∂–æ–∫ –∫ –¥–µ–ª—É.", good: false, delta: 8, aFaceGood: "laugh", aFaceBad: "focus" }
      ],
      judgeGood: "–ü—Ä–∏–Ω—è—Ç–æ! –£ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞ –µ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—É–∞–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.",
      judgeBad:  "–ó–∞–±–∞–≤–Ω–æ, –Ω–æ –æ—Å–Ω–æ–≤–∞–Ω–∏–π –º–∞–ª–æ–≤–∞—Ç–æ."
    },
    {
      nuraly: "–î–æ–≤–æ–¥ ‚Ññ3: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç‚Ä¶",
      nFace: "confident",
      options: [
        { text: "–ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Å—Ç–∞—è: —Ä—è–¥–æ–º —Å–æ –º–Ω–æ–π —á–∞—â–µ —É–ª—ã–±–∞—é—Ç—Å—è ‚ò∫Ô∏è", good: true, delta: 25, aFaceGood: "laugh", aFaceBad: "focus" },
        { text: "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –º–Ω–æ–≥–æ —Ü–∏—Ñ—Ä –∏ –º–∞–ª–æ —Å—á–∞—Å—Ç—å—è.", good: false, delta: 10, aFaceGood: "smile", aFaceBad: "focus" },
        { text: "–£ –º–µ–Ω—è –µ—Å—Ç—å –Ω–µ–æ–ø—Ä–æ–≤–µ—Ä–∂–∏–º—ã–π –∫–æ—Ç–∏–∫‚Ä¶ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏.", good: false, delta: 12, aFaceGood: "smile", aFaceBad: "focus" }
      ],
      judgeGood: "–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å —É–ª—ã–±–∞–µ–º–æ—Å—Ç–∏ –Ω–∏–∫—Ç–æ –Ω–µ –æ—Ç–º–µ–Ω—è–ª.",
      judgeBad:  "–ö–æ—Ç–∏–∫ –º–∏–ª, –Ω–æ –º–∞–ª–æ –¥–æ–∫–∞–∑–∞—Ç–µ–ª–µ–Ω."
    },
    {
      nuraly: "–î–æ–≤–æ–¥ ‚Ññ4: –∏—Ç–æ–≥–æ–≤–∞—è –º–æ–¥–µ–ª—å –¥–∞—ë—Ç 99.9% –º–æ–µ–π –ø—Ä–∞–≤–æ—Ç—ã.",
      nFace: "confident",
      options: [
        { text: "–û—Å—Ç–∞–≤—à–∏–µ—Å—è 0.1% ‚Äî –º–æ—è –º–∞–≥–∏—è. –ò —Å–µ–≥–æ–¥–Ω—è ‚Äî –º–æ–π –¥–µ–Ω—å.", good: true, delta: 25, aFaceGood: "proud", aFaceBad: "focus" },
        { text: "–ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—é: –∫–æ—Ñ–µ ‚Äî –≤ –º–æ—é –ø–æ–ª—å–∑—É.", good: false, delta: 10, aFaceGood: "smile", aFaceBad: "focus" },
        { text: "–°–º–µ—é—Å—å –≤ –ª–∏—Ü–æ –≤–∞—à–∏–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º ‚Äî –ø–æ-–¥–æ–±—Ä–æ–º—É.", good: false, delta: 12, aFaceGood: "laugh", aFaceBad: "focus" }
      ],
      judgeGood: "–ú–∞–≥–∏—è 0.1% –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–ø–æ—Ä.",
      judgeBad:  "–ó–∞–±–∞–≤–Ω–æ, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –¥–µ–ª–∞."
    }
  ];

  /*****  –°–û–°–¢–û–Ø–ù–ò–ï  *****/
  let roundIndex = 0;
  let progress = 0;
  let answered = false;
  let bribeCooldown = false;

  /*****  DOM  *****/
  const s1 = document.getElementById('s1');
  const s2 = document.getElementById('s2');
  const s3 = document.getElementById('s3');
  const bar = document.getElementById('bar');
  const startBtn = document.getElementById('startBtn');
  const bribeBtn = document.getElementById('bribeBtn');
  const roundIndicator = document.getElementById('roundIndicator');
  const arena = document.getElementById('arena');
  const nuralyImg = document.getElementById('nuralyImg');
  const nuralyLine = document.getElementById('nuralyLine');
  const aluaImg = document.getElementById('aluaImg');
  const choicesBox = document.getElementById('choices');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  const giftBtn = document.getElementById('giftBtn');
  const replayBtn = document.getElementById('replayBtn');
  const giftText = document.getElementById('giftText');

  const bgm = document.getElementById('bgm');
  const soundFab = document.getElementById('soundFab');

  /*****  –ê–£–î–ò–û  *****/
  if (AUDIO_SRC) bgm.src = AUDIO_SRC;
  function tryPlayAudio(){
    if (!AUDIO_SRC) { soundFab.style.display = 'inline-flex'; return; }
    bgm.volume = 0.35;
    bgm.play().then(()=>{
      soundFab.style.display = 'none';
    }).catch(()=>{
      soundFab.style.display = 'inline-flex';
    });
  }
  soundFab.addEventListener('click', ()=>{ tryPlayAudio(); });

  /*****  –ù–ê–í–ò–ì–ê–¶–ò–Ø  *****/
  function show(el){
    [s1,s2,s3].forEach(x=>x.classList.remove('active'));
    el.classList.add('active');
    // –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–∞—á–∞–ª—É —Å—Ü–µ–Ω—ã
    const top = el.getBoundingClientRect().top + window.scrollY - 12;
    window.scrollTo({ top, behavior: 'smooth' });
  }
  function setProgress(p){ progress = Math.max(0, Math.min(100, p)); bar.style.width = progress + '%'; if(progress<100) bribeBtn.style.display='inline-block'; }

  startBtn.addEventListener('click', ()=>{
    show(s2);
    setProgress(5);
    roundIndex = 0;
    renderRound();
    tryPlayAudio();
  });

  prevBtn.addEventListener('click', ()=>{
    if(roundIndex>0){
      roundIndex--;
      setProgress(progress - 5);
      renderRound(true);
    }
  });

  nextBtn.addEventListener('click', ()=>{
    if(progress>=100){ finish(); return; }
    if(roundIndex < ROUNDS.length-1){
      roundIndex++;
      renderRound();
    } else {
      if(progress>=90){ setProgress(100); finish(); }
      else toast("–ï—â—ë —á—É—Ç—å-—á—É—Ç—å ‚Äî –∏ –ø–æ–±–µ–¥–∞ –±—É–¥–µ—Ç –∑–∞ –ê–ª—É–∞!");
    }
  });

  bribeBtn.addEventListener('click', ()=>{
    if(bribeCooldown) return;
    bribeCooldown = true;
    setTimeout(()=> bribeCooldown=false, 3000);
    setProgress(progress + 20);
    toast("–°—É–¥—å—è: ¬´–ö–æ—Ñ–µ –ø—Ä–∏–Ω—è—Ç. –ü–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞—é –æ—Ü–µ–Ω–∫—É –≤ –ø–æ–ª—å–∑—É –ê–ª—É–∞ üòå¬ª");
    nuralySwap("surprised");
    aluaSwap("smile");
    if(progress>=100) finish();
  });

  /*****  –†–ï–ù–î–ï–† –†–ê–£–ù–î–ê  *****/
  function renderRound(backward=false){
    const r = ROUNDS[roundIndex];
    answered = false;
    nextBtn.disabled = true;
    prevBtn.disabled = (roundIndex===0);
    roundIndicator.textContent = `–†–∞—É–Ω–¥ ${roundIndex+1} –∏–∑ ${ROUNDS.length}`;

    // –∞–≤–∞—Ç–∞—Ä–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞—É–Ω–¥–∞
    nuralySwap(r.nFace || "confident");
    aluaSwap("focus");

    nuralyLine.textContent = r.nuraly;

    choicesBox.innerHTML = "";
    r.options.forEach((opt)=>{
      const btn = document.createElement('button');
      btn.className = 'choice';
      btn.innerHTML = `<b>${opt.text}</b>`;
      btn.addEventListener('click', ()=>{
        if (answered) return;
        answered = true;
        const good = !!opt.good;
        btn.classList.add(good ? 'good' : 'bad');

        // —Ä–µ–∞–∫—Ü–∏–∏ –∏ –æ—á–∫–∏
        if(good){
          setProgress(progress + (opt.delta||25));
          toast(r.judgeGood || "–ê—Ä–≥—É–º–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç!");
          ding(true);
          aluaSwap(opt.aFaceGood || "smile");
          nuralySwap("happy");
        } else {
          setProgress(progress + (opt.delta||10));
          toast(r.judgeBad || "–°–∏–º–ø–∞—Ç–∏—á–Ω–æ, –Ω–æ —Å–ª–∞–±–æ–≤–∞—Ç–æ.");
          ding(false);
          aluaSwap(opt.aFaceBad || "focus");
          nuralySwap("surprised");
        }

        nextBtn.disabled = false;
        if(progress>=100){ finish(); }
      });
      choicesBox.appendChild(btn);
    });

    if(backward){ setProgress(progress - 3); }
  }

  function nuralySwap(face){
    const src = IMG.nuraly[face] || IMG.nuraly.calm;
    nuralyImg.src = src; nuralyImg.alt = `–ù—É—Ä–∞–ª–∏ ‚Äî ${face}`;
  }
  function aluaSwap(face){
    const src = IMG.alua[face] || IMG.alua.focus;
    aluaImg.src = src; aluaImg.alt = `–ê–ª—É–∞ ‚Äî ${face}`;
  }

  /*****  –§–ò–ù–ê–õ  *****/
  function finish(){
    show(s3);
    // —Ç–æ—Ä–∂–µ—Å—Ç–≤—É—é—â–∞—è –ê–ª—É–∞
    aluaImg.src = IMG.alua.proud;
    fireConfetti();
    setTimeout(()=>fireConfetti(), 400);
    setTimeout(()=>fireConfetti(), 900);
  }

  giftBtn.addEventListener('click', async ()=>{
    giftBtn.disabled = true;
    floatingHearts();
    await typeWriter(giftText,
`–ê–ª—É–∞, –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–∏–∑–Ω–∞—é —Ç–≤–æ—é –ü–æ–±–µ–¥—É –≤ —Å–ø–æ—Ä–µ ‚ù§Ô∏è

‚Ä¢ –¢–≤–æ—è —É–ª—ã–±–∫–∞ —Å–∏–ª—å–Ω–µ–µ –ª—é–±—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
‚Ä¢ –°—á–∞—Å—Ç—å–µ ‚Äî –∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–º—É –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é.
‚Ä¢ –ö–æ—Ñ–µ ‚Äî –ø–æ –ø–µ—Ä–≤–æ–º—É —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é.
‚Ä¢ –£–ª—ã–±–∫–∏ –∏ –æ–±—ä—è—Ç–∏—è ‚Äî –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å.
‚Äî –ù—É—Ä–∞–ª–∏`);
    setProgress(100);
  });

  replayBtn.addEventListener('click', ()=>{
    // —Å–±—Ä–æ—Å
    progress = 0; setProgress(0);
    giftBtn.disabled = false; giftText.textContent = '';
    show(s1);
  });

  /*****  –≠–§–§–ï–ö–¢–´ –ò –£–¢–ò–õ–ò–¢–´  *****/
  function fireConfetti(){
    confetti({ particleCount: 90, spread: 70, startVelocity:45, origin:{ y: 0.7 } });
  }
  function floatingHearts(){
    const emojis=['üíô','üíõ','üíñ','‚ú®','üí´','üíô','üíõ','üíñ'];
    for(let i=0;i<24;i++){
      const s=document.createElement('div');
      s.className='heart'; s.textContent=emojis[i%emojis.length];
      s.style.left=(Math.random()*92+4)+'vw';
      s.style.animationDuration=(4+Math.random()*3)+'s';
      s.style.fontSize=(18+Math.random()*14)+'px';
      document.body.appendChild(s);
      setTimeout(()=>s.remove(),7000);
    }
  }
  async function typeWriter(node, text){
    node.textContent='';
    for(let i=0;i<text.length;i++){
      node.textContent += text[i];
      await new Promise(r=>setTimeout(r, 18));
    }
  }
  function toast(msg){
    const el = document.createElement('div'); el.className='toast'; el.textContent=msg; document.body.appendChild(el);
    requestAnimationFrame(()=>{ el.style.transition='opacity .2s'; el.style.opacity='1'; });
    setTimeout(()=>{ el.style.opacity='0'; setTimeout(()=>el.remove(), 200); }, 1800);
  }
  function ding(success=true){
    try{
      const ctx = new (window.AudioContext||window.webkitAudioContext)();
      const o = ctx.createOscillator(); const g = ctx.createGain();
      o.type = success ? 'triangle':'sawtooth';
      o.frequency.value = success ? 820 : 320;
      g.gain.value = 0.00001; g.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime);
      o.connect(g); g.connect(ctx.destination); o.start();
      g.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime+0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.25);
      o.stop(ctx.currentTime+0.3);
    }catch(e){}
  }

  // –ø–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ–ø–ª–µ—è —Å—Ä–∞–∑—É
  document.addEventListener('DOMContentLoaded', ()=>{
    tryPlayAudio();
  });
</script>
</body>
</html>
